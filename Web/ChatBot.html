<!DOCTYPE html>
<html lang="en-US">
<head>
	<title>Saggezza - Chat Bot</title>
	<link rel="icon" href="./Images/cropped-favicon_saggezza-32x32.png" sizes="32x32">
	<link rel="stylesheet prefetch" href="https://fonts.googleapis.com/css?family=Open+Sans">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style>
		html, body {
			height: 100%
		}

		body {
			margin: 0;
			font-family:'Open Sans', sans-serif;
		}

		#webchat {
			height: 100%;
			width: 100%;
		}
		#webchat>div{
			background-image: url(./Images/Saggezza_background.png);
		}

		.main form input{
			background: none;
		}
		
		.chat-title {
			-webkit-box-flex: 0;
			-webkit-flex: 0 1 45px;
			-ms-flex: 0 1 45px;
			flex: 0 1 45px;
			position: fixed;
			z-index: 2;
			background: rgba(0, 0, 0, 0.2);
			color: #fff;
			text-transform: uppercase;
			text-align: left;
			padding: 10px 10px 10px 50px;
		}
		.chat-title h1, .chat-title h2 {
			font-weight: bold;
			font-size: 1.2rem;
			color: black;
			margin: 0;
			padding: 0;
		}
		.chat-title {   
			width: 100%;    
			z-index: 2;
			overflow: hidden;    
			background-attachment: fixed;
			background-size: 100%;
			display: -webkit-box;
			display: -webkit-flex;
			display: -ms-flexbox;
			display: flex;
			-webkit-box-pack: justify;
			-webkit-justify-content: space-between;
			-ms-flex-pack: justify;
			justify-content: space-between;
			-webkit-box-orient: vertical;
			-webkit-box-direction: normal;
			-webkit-flex-direction: column;
			-ms-flex-direction: column;
			flex-direction: column;
		}

		.chat-title .avatar {
			position: absolute;
			z-index: 1;
			top: 8px;
			left: 9px;
			border-radius: 30px;
			width: 30px;
			height: 30px;
			overflow: hidden;
			margin: 0;
			padding: 0;
			border: 2px solid rgba(255, 255, 255, 0.24);
		}
		.chat-title .avatar img {
			width: 100%;
			height: auto;
		}
		.chat-title h2 {
			color: #fff;
			font-size: 8px;
			letter-spacing: 1px;
		}
		
	</style>
    <!--
      This CDN points to the latest official release of Web Chat. If you need to test against Web Chat's latest bits, please refer to pointing to Web Chat's MyGet feed:
      https://github.com/microsoft/BotFramework-WebChat#how-to-test-with-web-chats-latest-bits
  -->
  <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>

  <!-- We are using simple-update-in package to simplify demo code. -->
  <script src="https://unpkg.com/simple-update-in/dist/simple-update-in.production.min.js"></script>

</head>
<body>
	<div class="chat-title">
		<h1>Saggezza</h1>
		<h2>Service Desk - Bot</h2>
		<figure class="avatar">
			<img src="./Images/logo_saggezza.png"></figure>
		</div>
		<div id="webchat" role="main"></div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>	
		<script>
			(async function () {
            // In this demo, we are using Direct Line token from MockBot.
            // To talk to your bot, you should use the token exchanged using your Direct Line secret.
            // You should never put the Direct Line secret in the browser or client app.
            // https://docs.microsoft.com/en-us/azure/bot-service/rest-api/bot-framework-rest-direct-line-3-0-authentication

            const res = await fetch('https://webchat-mockbot.azurewebsites.net/directline/token', { method: 'POST' });
            const { token } = await res.json();
            var UserEmail = sessionStorage.getItem("UserEmailId");
            var UserAvatar = sessionStorage.getItem("UserAvatar");

            const styleOptions = {
            	backgroundColor:'#83BB00',            	

            	botAvatarImage: './Images/logo_saggezza.png',
            	botAvatarInitials: 'SG',
            	userAvatarImage: UserAvatar ,
            	userAvatarInitials: '',

            	// Send box
            	hideSendBox: false,
            	hideUploadButton: true,
            	microphoneButtonColorOnDictate: '#F33',
            	sendBoxBackground: 'rgba(0, 0, 0, 0.3)',
            	sendBoxButtonColor: '#fff',
            	sendBoxButtonColorOnDisabled: '#ccc',
            	sendBoxButtonColorOnFocus: '#fff',
            	sendBoxButtonColorOnHover: '#333',
            	sendBoxHeight: 40,
            	sendBoxMaxHeight: 200,
            	sendBoxTextColor: 'White',
            	sendBoxBorderBottom: '',
            	sendBoxBorderLeft: '',
            	sendBoxBorderRight: '',
            	sendBoxBorderTop: 'none',
            	sendBoxPlaceholderColor: '#fff',
            	sendBoxTextWrap: false,
            };


            // We are adding a new middleware to customize the behavior of DIRECT_LINE/POST_ACTIVITY.
            const store = window.WebChat.createStore(
            	{},
            	({ dispatch }) => next => action => {
            		if (action.type === 'DIRECT_LINE/POST_ACTIVITY') {
                        // The channelData submitted here is very similar to HTTP cookies and vulnerable to forgery attack.
                        // Make sure you use signature to protect it and verify the signature on the bot side.

                        // To minimize unexpected behaviors, we recommend to treat the "action" object as if it is immutable.
                        // We use simple-update-in package to update "action" with partial deep cloning.
                        action = window.simpleUpdateIn(action, ['payload', 'activity', 'channelData', 'email'], () => UserEmail);
                        action = window.simpleUpdateIn(action, ['payload', 'activity', 'channelData', 'Name'], () => "UserEmail");
                    }

                    return next(action);
                }
                );

            window.WebChat.renderWebChat({
            	directLine: window.WebChat.createDirectLine({ token: 'Bg_uf1m3oOI.LqD3ef0uTHmollzaeZWXLXwurzrT6ISTP2Kj_Y63wII' }),
                // We will use a custom version of Redux store, which we added middleware to handle backchannel messages.
                store,
                styleOptions,                 

            }, document.getElementById('webchat'));



            document.querySelector('#webchat > *').focus();
        })().catch(err => console.error(err));
    </script>   
</body>
</html>